<%- include('partials/_head') %>
<link rel="stylesheet" href="/css/nova-receita.css">
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <main>
    <div class="overlay">
      <div class="card-cadastro" data-recipe-id="<%= recipe.id %>">
        
        <div class="header-card">
          <p id="titulo-etapa">Editar receita</p>
          <span class="fechar" onclick="fecharModal()">✕</span>
        </div>

        <div class="conteudo">
          <!-- se quiser manter a barra de progresso, deixei aqui fixa -->
          <div class="custom-progress">
            <div class="progress-bar" role="progressbar"></div>
            <div class="bolinha"></div>
          </div>

          <!-- Aqui, diferente da criação, vamos mostrar TODOS os campos de uma vez -->

          <form id="form-editar-receita">
            <!-- ============ CAMPOS BÁSICOS ============ -->
            <label for="nome">Nome da receita:</label>
            <input
              type="text"
              id="nome"
              autocomplete="off"
              value="<%= recipe.title %>"
            >

            <label for="categoria">Categoria:</label>
            <select id="categoria">
              <option value="">Selecione</option>
              <option value="Bolos e tortas" <%= recipe.category === 'Bolos e tortas' ? 'selected' : '' %>>Bolos e tortas</option>
              <option value="Carnes" <%= recipe.category === 'Carnes' ? 'selected' : '' %>>Carnes</option>
              <option value="Aves" <%= recipe.category === 'Aves' ? 'selected' : '' %>>Aves</option>
              <option value="Peixes e frutos do mar" <%= recipe.category === 'Peixes e frutos do mar' ? 'selected' : '' %>>Peixes e frutos do mar</option>
              <option value="Saladas e molhos" <%= recipe.category === 'Saladas e molhos' ? 'selected' : '' %>>Saladas e molhos</option>
              <option value="Sopas" <%= recipe.category === 'Sopas' ? 'selected' : '' %>>Sopas</option>
              <option value="Massas" <%= recipe.category === 'Massas' ? 'selected' : '' %>>Massas</option>
              <option value="Bebidas" <%= recipe.category === 'Bebidas' ? 'selected' : '' %>>Bebidas</option>
              <option value="Lanches" <%= recipe.category === 'Lanches' ? 'selected' : '' %>>Lanches</option>
              <option value="Doces e sobremesas" <%= recipe.category === 'Doces e sobremesas' ? 'selected' : '' %>>Doces e sobremesas</option>
              <option value="Alimentação saudável" <%= recipe.category === 'Alimentação saudável' ? 'selected' : '' %>>Alimentação saudável</option>
            </select>

            <label for="subcategoria">Subcategoria:</label>
            <select id="subcategoria">
              <% if (recipe.subcategory) { %>
                <option value="<%= recipe.subcategory %>" selected><%= recipe.subcategory %></option>
              <% } else { %>
                <option value="">Selecione a categoria primeiro</option>
              <% } %>
            </select>

            <label for="sobre">Sobre a receita:</label>
            <textarea
              id="sobre"
              maxlength="500"
              rows="4"
              placeholder="Descreva brevemente sua receita"
            ><%= recipe.description || '' %></textarea>

            <!-- ============ INGREDIENTES ============ -->
            <p class="inserir" id="btn-add-ingrediente">+ Inserir ingrediente</p>
            <div id="lista-ingredientes">
              <% if (ingredientes && ingredientes.length) { %>
                <% ingredientes.forEach(function(ing, index) { %>
                  <input
                    type="text"
                    class="ingrediente-input"
                    placeholder="<%= (index + 1) + ' -' %>"
                    value="<%= ing %>"
                  >
                <% }) %>
              <% } else { %>
                <input type="text" class="ingrediente-input" placeholder="1 -">
                <input type="text" class="ingrediente-input" placeholder="2 -">
              <% } %>
            </div>

            <!-- ============ MODO DE PREPARO ============ -->
            <p class="inserir" id="btn-add-preparo">+ Inserir etapa de preparo</p>
            <div id="lista-preparo">
              <% if (passos && passos.length) { %>
                <% passos.forEach(function(step, index) { %>
                  <input
                    type="text"
                    class="preparo-input"
                    placeholder="<%= (index + 1) + ' -' %>"
                    value="<%= step %>"
                  >
                <% }) %>
              <% } else { %>
                <input type="text" class="preparo-input" placeholder="1 -">
                <input type="text" class="preparo-input" placeholder="2 -">
              <% } %>
            </div>

            <label for="tempo-preparo">Tempo de Preparo:</label>
            <input
              type="text"
              id="tempo-preparo"
              placeholder="Ex: 30 min"
              value="<%= recipe.prep_time_min || '' %>"
            >

            <!-- ============ DICA ============ -->
            <label for="dica">Dica do chef:</label>
            <textarea
              id="dica"
              rows="5"
              maxlength="500"
              placeholder="Máximo 150 caracteres"
            ><%= recipe.tip || '' %></textarea>

            <!-- ============ IMAGEM (apenas visual / futuro) ============ -->
            <label for="imagem-receita">Foto da receita:</label>
            <div id="lista-imagens">
              <input type="file" accept="image/*">
            </div>

            <div class="botoes">
              <div class="botoes-esquerda">
                <button type="button" class="btn-voltar" onclick="fecharModal()">← Voltar</button>
              </div>
              <div class="botoes-direita">
                <button type="submit">Salvar alterações</button>
              </div>
            </div>
          </form>

        </div>
      </div>
    </div>
  </main>

  <script src="/js/editar-receita.js" defer></script>
</body>
</html>
